<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center">
    <h2>Task Details</h2>
    <button mat-icon-button [routerLink]="['/listTasks']" class="btn btn-light">
      <i class="material-icons">arrow_back</i>
    </button>
  </div>

  <div *ngIf="task">
    <p>
      <strong>Step Name:</strong> {{ step?.stepName }} {{ step?.description }}
    </p>
    <p><strong>Step Description</strong> {{ step?.description }}</p>
    <p><strong> Task ID:</strong> {{ task.id }}</p>
    <p><strong>Name:</strong> {{ task.taskName }}</p>
    <p><strong>Description:</strong> {{ task.description }}</p>
    <p><strong>Instructions:</strong> {{ task.instructions }}</p>
    <p><strong>Status:</strong> {{ task.status }}</p>
    <p>
      <strong>Required Verification:</strong> {{ task.requiredVerification }}
    </p>

    <div *ngIf="task.fileIds.length > 0">
      <h3>Files</h3>
      <ul>
        <li *ngFor="let file of files">
          {{ file.fileName }} ({{ (file.size / 1048576).toFixed(2) }} MB)
          <button
            *ngIf="file.id"
            (click)="downloadFile(file.id)"
            class="download-button"
          >
            Download
          </button>
        </li>
      </ul>
    </div>
    <p><strong>Assigned Job IDs:</strong> {{ task.assignedJobIds }}</p>
    <div *ngIf="methods.length > 0">
      <h3>Method Details</h3>
      <div *ngFor="let method of methods">
        <p><strong>Name:</strong> {{ method.methodName }}</p>
        <div *ngIf="method.parameters.length > 0">
          <h4>Parameters</h4>
          <ul>
            <li *ngFor="let parameter of method.parameters">
              {{ parameter.parameterName }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div *ngIf="task && task.feedbacks && task.feedbacks.length > 0">
      <h3>Feedbacks</h3>
      <ul>
        <li *ngFor="let feedback of task.feedbacks">
          <p><strong>Feedback:</strong> {{ feedback?.['message'] }}</p>
          <p>
            <strong>Date:</strong>
            {{ feedback?.['feedbackDate'] | date:'medium' }}
          </p>
        </li>
      </ul>
    </div>

    <!-- ... -->
    <!-- ... -->

    <div *ngIf="task.parentTaskIds.length > 0">
      <h3>Parent Tasks</h3>
      <ul>
        <li *ngFor="let parentTaskId of task.parentTaskIds">
          <ng-container *ngIf="parentTaskId !== null">
            <a routerLink="/taskDetails/{{ parentTaskId }}">{{
              parentTaskNames[parentTaskId]
            }}</a>
          </ng-container>
        </li>
      </ul>
    </div>

    <div *ngIf="task.childTaskIds.length > 0">
      <h3>Child Tasks</h3>
      <ul>
        <li *ngFor="let childTaskId of task.childTaskIds">
          <ng-container *ngIf="childTaskId !== null">
            <a routerLink="/taskDetails/{{ childTaskId }}">{{
              childTaskNames[childTaskId]
            }}</a>
          </ng-container>
        </li>
      </ul>
    </div>
  </div>
</div>
